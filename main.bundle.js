!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t){t.exports=JSON.parse('{"0":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,0,0,0,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0]},"1":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,1,1,1]},"2":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,0,0,0,0,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,1,1,1,1]},"3":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"4":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,0,1,1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0]},"5":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"6":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,1,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"7":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0]},"8":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,0,0,1,1,0,0,0,1,0,1,1,1,0,0,1,0,0,1,1,1,1,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,1,1,1,1,1,0]},"9":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,1,1,1,1,0,0]}," ":{"offsetX":-2,"offsetY":0,"width":7,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},".":{"offsetX":0,"offsetY":0,"width":2,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,1,1,1,1]},":":{"offsetX":0,"offsetY":0,"width":2,"height":7,"tile":[0,0,1,1,1,1,0,0,0,0,1,1,1,1]},";":{"offsetX":0,"offsetY":2,"width":2,"height":7,"tile":[1,1,1,1,0,0,0,0,1,1,0,1,1,0]},"\'":{"offsetX":0,"offsetY":0,"width":2,"height":7,"tile":[1,1,1,1,0,1,0,0,0,0,0,0,0,0]},"\\"":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[1,1,0,1,1,1,1,0,1,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},",":{"offsetX":0,"offsetY":2,"width":2,"height":7,"tile":[0,0,0,0,0,0,0,0,1,1,0,1,1,0]},"!":{"offsetX":1,"offsetY":0,"width":2,"height":7,"tile":[1,1,1,1,1,1,1,1,1,1,0,0,1,1]},"?":{"offsetX":0,"offsetY":0,"width":6,"height":7,"tile":[0,1,1,1,1,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0]},"_":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1]},"-":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},"+":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0]},"=":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]},"*":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[1,0,1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0]},"(":{"offsetX":0,"offsetY":-1,"width":3,"height":9,"tile":[0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,1,1]},")":{"offsetX":0,"offsetY":-1,"width":3,"height":9,"tile":[1,1,0,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0]},"/":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0]},"A":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,0,0,0,1,1,0,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1]},"B":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0]},"C":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,1,1,1,1,0]},"D":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,0,0]},"E":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,1]},"F":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0]},"G":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,1,1,1,1,1,0,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,1,1,1]},"H":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1]},"I":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,1,1,1]},"J":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"K":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,1]},"L":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1]},"M":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1]},"N":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,1,1]},"O":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"P":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0]},"Q":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,1]},"R":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,1]},"S":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"T":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0]},"U":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"V":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0]},"W":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1]},"X":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,0,1,1]},"Y":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,0,0,1,1,0,1,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0]},"Z":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,1,1,1,1,1]}}')},function(t,e,i){"use strict";i.r(e);var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var o,a,s,r,l,c,h=!1,f=0;function g(){h&&(requestAnimationFrame(g),s=Date.now(),(a=s-o)>24&&(o=s-a%24,l.debug.onTick&&console.log(f),r(),f++))}function d(){return{items:[],addItems:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.items.find((function(e){return e.name===t}));n||(n={name:t,items:[]},this.items.push(n));for(var o=0,a=e;o<a.length;o++){var s=a[o];n.items.push(s)}},draw:function(t,e){this.items.forEach((function(i){i.items.forEach((function(i){i.sprite.draw(t,e,c)}))}))},empty:function(){this.items=[]},getItem:function(t){for(var e,i=0,n=this.items;i<n.length;i++){for(var o=0,a=n[i].items;o<a.length;o++){var s=a[o];if(s.name===t){e=s.sprite;break}}if(e)break}return e},getGroup:function(t){return this.items.find((function(e){return e.name===t}))},removeGroup:function(t){for(var e=0;e<this.items.length;e++)if(this.items[e].name===t){this.items.splice(e,1);break}},removeItem:function(t,e){for(var i=0,n=this.items;i<n.length;i++){var o=n[i];if(o.name===t){for(var a=0;a<o.items.length;a++)if(o.items[a].name===e){o.items.splice(a,1);break}break}}}}}function u(t,e){var i=Object.keys(t).length,n={},o=0;i||e({});var a=function(a){var s=new XMLHttpRequest;s.onload=function(){if(!(s.status>=200&&s.status<300))throw console.error(s.responseText),new Error('Tile "'+a+'" was not found');n[a]=JSON.parse(s.responseText),++o===i&&e(n)},s.open("GET",t[a]),s.send()};for(var s in t)a(s)}function p(t,e){var i={};for(var n in t){var o=t[n];o.endsWith(e)&&(i[n]=o)}return i}function m(t,e,i){function n(t){i(t)}t.load(p(e,".mp3"),(function(){u(p(e,".json"),n)}))}var v=function(){},y=[],w={upPress:v,leftPress:v,downPress:v,rightPress:v,aPress:v,bPress:v,selectPress:v,startPress:v,upRelease:v,leftRelease:v,downRelease:v,rightRelease:v,aRelease:v,bRelease:v,selectRelease:v,startRelease:v,keyDown:v,keyUp:v,reset:function(){w.upPress=v,w.leftPress=v,w.downPress=v,w.rightPress=v,w.aPress=v,w.bPress=v,w.selectPress=v,w.startPress=v,w.upRelease=v,w.leftRelease=v,w.downRelease=v,w.rightRelease=v,w.aRelease=v,w.bRelease=v,w.selectRelease=v,w.startRelease=v,w.keyDown=v,w.keyUp=v},update:function(){for(var t=0,e=y;t<e.length;t++){var i=e[t];w[i]()}y=[]}};document.onkeydown=function(t){switch(t.preventDefault(),t.key){case"w":case"W":case"ArrowUp":y.push("upPress");break;case"d":case"D":case"ArrowRight":y.push("rightPress");break;case"s":case"S":case"ArrowDown":y.push("downPress");break;case"a":case"A":case"ArrowLeft":y.push("leftPress");break;case"j":case"J":case"z":case"Z":y.push("aPress");break;case"k":case"K":case"x":case"X":y.push("bPress");break;case" ":y.push("selectPress");break;case"Enter":y.push("startPress")}t.metaKey||y.push("keyDown")},document.onkeyup=function(t){switch(t.preventDefault(),t.key){case"w":case"W":case"ArrowUp":y.push("upRelease");break;case"d":case"D":case"ArrowRight":y.push("rightRelease");break;case"s":case"S":case"ArrowDown":y.push("downRelease");break;case"a":case"A":case"ArrowLeft":y.push("leftRelease");break;case"j":case"J":case"z":case"Z":y.push("aRelease");break;case"k":case"K":case"x":case"X":y.push("bRelease");break;case" ":y.push("selectRelease");break;case"Enter":y.push("startRelease")}t.metaKey||y.push("keyUp")};var b,P={tracks:{},load:function(t,e){var i=Object.keys(t).length,n=0;function o(){++n===i&&e()}for(var a in i||e(),t){var s=new Audio;this.tracks[a]=s,s.src=t[a],s.oncanplaythrough=o}},play:function(t,e,i){var n=this;void 0===e&&(e=!1),i&&(this.tracks[t].onended=function(){i(),n.tracks[t].onended=null}),this.tracks[t].loop=e,this.tracks[t].play()},pause:function(t){this.tracks[t].pause()},pauseAll:function(){for(var t in this.tracks)this.tracks[t].pause()}},x=function(){return(x=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},k=function(t,e){for(var i=0,n=e.length,o=t.length;i<n;i++,o++)t[o]=e[i];return t},A={},T=!1,I={count:0,ticks:0,callback:function(){},init:function(t,e){this.count=0,this.ticks=t,this.callback=e},update:function(){this.count++,this.count===this.ticks&&this.callback()}};function S(t){t.canvas.clear("static",t.bgColor),t.staticPool.draw("static",t.canvas)}function X(t){t.canvas.clear("dynamic"),t.dynamicPool.draw("dynamic",t.canvas)}function R(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];b.data=t,b.init.apply(b,e),S(b),b.redrawStaticItems=function(){return S(b)},b.canvas.onResize=function(){"function"==typeof b.onResize&&b.onResize(),S(b)},T=!1}function Y(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!A[t])throw new Error('scene "'+t+'" does not exist');T=!0,b&&(b.data={},b.staticPool.empty(),b.dynamicPool.empty(),b.controls.reset(),"function"==typeof b.destroy&&b.destroy()),(b=A[t]).changeScene=Y,b.preload&&Object.keys(b.preload).length?(b.config.debug&&console.log("waiting for "+t+" preload..."),m(b.mediaPlayer,b.preload,(function(t){R.apply(void 0,k([t],e))}))):(R.apply(void 0,k([{}],e)),b.config.debug&&console.log("loaded scene: "+t))}var O=function(){return(O=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function E(t){return void 0===t&&(t={}),O({x:0,y:0,width:0,height:0,centerX:function(t){var e=t.x+t.width/2;this.x=Math.floor(e-this.width/2)},centerY:function(t){var e=t.y+t.height/2;this.y=Math.floor(e-this.height/2)}},t)}var C=function(){return(C=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function j(t,e,i,n,o){var a=0,s=0,r=e.config.ppp,l=o.tiles[o.frame];e.context[t].globalAlpha=1;for(var c=0;c<l.length;c++){var h=l[c];h&&(e.context[t].fillStyle=h,e.context[t].fillRect((i+a)*r,(n+s)*r,r,r)),a===o.width-1?(a=0,s++):a++}}var H={font:i(0),tracking:1,lineHeight:10};function N(t,e){if(t[e])return!0;throw new Error('Font does not contain the character "'+e+'"')}function M(t,e,i,n,o){for(var a=0,s=0,r=e.config.ppp,l=0;l<o.tile.length;l++)1===o.tile[l]&&e.context[t].fillRect((i+a+o.offsetX)*r,(n+s+o.offsetY)*r,r,r),a===o.width-1?(a=0,s++):a++}function D(t,e,i,n,o,a){for(var s=o.split(""),r=i,l=n,c=0;c<s.length;c++){var h=s[c];N(a.font,h)&&(M(t,e,r,l,a.font[h]),r+=a.font[h].width),r+=a.tracking}}function W(t,e,i){for(var n=[],o=t.split(" "),a=H.font[" "],s=a.width+a.offsetX+e.tracking,r="",l=0,c=0;c<o.length;c++){for(var h=o[c],f=0,g=0,d=h.split("");g<d.length;g++){var u=d[g];if(N(e.font,u)){var p=e.font[u];f+=p.width+p.offsetX+e.tracking}}(l+=f+=s)<=i?r+=h+" ":(n.push(r),r=h+" ",l=f)}return n.push(r.trimEnd()),n}var G=function(){return(G=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function F(t){void 0===t&&(t={});var e=E({width:t.metaTile.width,height:t.metaTile.height}),i=function(t){return void 0===t&&(t={}),C({color:"#065",rectangle:E(t.rectangle),draw:function(t,e){var i=e.config.ppp;e.context[t].globalAlpha=.4,e.context[t].fillStyle=this.color,e.context[t].fillRect(this.rectangle.x*i,this.rectangle.y*i,this.rectangle.width*i,this.rectangle.height*i)},hit:function(t){return!1}},t)}({rectangle:e});return G({animations:{},hitBox:i,metaTile:null,playingAnimation:null,rectangle:e,visible:!0,draw:function(t,n,o){this.visible&&(!function(t,n,o){i.rectangle.x=e.x,i.rectangle.x=e.x,o.debug.hitBox&&i.draw(t,n)}(t,n,o),o.debug.onTick&&console.log("MetaTileSprite.draw()"+(this.playingAnimation?" animation("+this.playingAnimation+")":"")),this.playingAnimation?this.animations[this.playingAnimation].draw(t,n):j(t,n,this.rectangle.x,this.rectangle.y,this.metaTile))},addAnimation:function(t,e,i,n,o){var a=this,s=!0,r=!1,l=e,c=0;a.animations[t]={start:function(){s=!0},stop:function(t){t&&(l=t>0?t:i),s=!1},draw:function(t,h){c<n?c++:(s&&(l=Math.min(i,++l)),r&&("loop"===o?l=e:"function"==typeof o&&o(),r=!1),c=0),s&&l===i&&(r=!0),a.metaTile.frame=l,j(t,h,a.rectangle.x,a.rectangle.y,a.metaTile)}}},startAnimation:function(t){this.animations[t].start(),this.playingAnimation=t},stopAnimation:function(){this.playingAnimation&&(this.animations[this.playingAnimation].stop(),this.playingAnimation=null)}},t)}function L(t){void 0===t&&(t={});var e=E({width:t.maxWidth||function(t,e){for(var i=0,n=0,o=t.split("");n<o.length;n++){var a=o[n];if(N(e.font,a)){var s=e.font[a];i+=s.width+s.offsetX+e.tracking}}return i}(t.value,t.options)});return G({animations:{},color:"#c59",maxWidth:null,options:{font:null,tracking:0,lineHeight:0},playingAnimation:null,rectangle:e,value:"",visible:!0,draw:function(t,e,i){if(this.visible)if(e.context[t].fillStyle=this.color,i.debug.onTick&&console.log("TextSprite.draw()"+(this.playingAnimation?" animation("+this.playingAnimation+")":"")),this.playingAnimation)this.animations[this.playingAnimation].draw(t,e);else if(this.maxWidth)for(var n=W(this.value,this.options,this.maxWidth),o=this.rectangle.y,a=0,s=n;a<s.length;a++){var r=s[a];D(t,e,this.rectangle.x,o,r,this.options),o+=this.options.lineHeight}else D(t,e,this.rectangle.x,this.rectangle.y,this.value,this.options)},addAnimation:function(t,e,i,n,o){var a=this,s=a.value.split("").length,r=0,l=e,c=!1,h=!0;i=i>0?i:s,a.animations[t]={start:function(){h=!0},stop:function(t){t&&(l=t>0?t:s),h=!1},draw:function(t,s){if(a.visible)if(r<n?r++:(h&&(l=Math.min(i,++l)),c&&("loop"===o?l=e:"function"==typeof o&&o(),c=!1),r=0),h&&l===i&&(c=!0),a.maxWidth)for(var f=W(a.value,a.options,a.maxWidth),g=a.rectangle.y,d=0,u=0,p=f;u<p.length;u++){var m=p[u];if(!(d+m.length<l)){D(t,s,a.rectangle.x,g,m.slice(0,l-d),a.options),d+=l-d;break}D(t,s,a.rectangle.x,g,m,a.options),d+=m.length,g+=a.options.lineHeight}else D(t,s,a.rectangle.x,a.rectangle.y,a.value.slice(0,l),a.options)}}},startAnimation:function(t){this.animations[t].start(),this.playingAnimation=t},stopAnimation:function(){this.animations[this.playingAnimation].stop(),this.playingAnimation=null}},t)}function B(t){return void 0===t&&(t={}),G({fill:null,opacity:1,rectangle:E(),strokeColor:null,strokeWidth:1,visible:!0,draw:function(t,e,i){this.visible&&(i.debug.onTick&&console.log("RectangleSprite.draw()"),function(t,e,i,n,o,a,s){var r=e.config.ppp,l=e.context[t],c=l.globalAlpha;l.globalAlpha=s,i&&(l.fillStyle=i,l.fillRect(a.x*r,a.y*r,a.width*r,a.height*r)),n&&(l.strokeStyle=n,l.lineWidth=o,l.strokeRect(a.x*r,a.y*r,a.width*r,a.height*r)),l.globalAlpha=c}(t,e,this.fill,this.strokeColor,this.strokeWidth,this.rectangle,this.opacity))}},t)}var U={offsetX:7,offsetY:1,ticksPerBlink:16,tickCount:0,update:function(t,e){var i=t.dynamicPool.getItem("cursor");this.tickCount<this.ticksPerBlink?this.tickCount++:(i.visible=!i.visible,this.tickCount=0),i.rectangle.x=e.x-i.rectangle.width-this.offsetX,i.rectangle.y=e.y-this.offsetY}};function z(t){var e=t.config.titleSafe,i=E({width:t.canvas.config.width,height:t.canvas.config.height}),n=t.staticPool.getItem("title"),o=t.staticPool.getItem("about"),a=t.staticPool.getItem("about2"),s=t.staticPool.getItem("link"),r=t.staticPool.getItem("back");n.rectangle.centerX(i),n.rectangle.y=e,o.rectangle.x=e,o.rectangle.y=n.rectangle.y+2*H.lineHeight,a.rectangle.x=e,a.rectangle.y=o.rectangle.y+6*H.lineHeight,r.rectangle.centerX(i),r.rectangle.y=i.height-H.lineHeight-e,s.rectangle.centerX(i),s.rectangle.y=r.rectangle.y-2*H.lineHeight}var K={index:0},J={name:"about",bgColor:"#000",preload:{cursor:"src/scenes/assets/title/cursor.json"},init:function(){var t=this;K.index=0,U.tickCount=0,this.staticPool.addItems("main",{name:"title",sprite:L({color:"#eee",options:H,value:"ABOUT"})}),this.staticPool.addItems("main",{name:"about",sprite:L({color:"#eee",options:H,maxWidth:this.canvas.config.width-2*this.config.titleSafe,value:"THIS PROJECT IS AN ODE TO ONE OF MY FAVORITE PODCASTS: HELLO FROM THE MAGIC TAVERN. IT IS NOT AFFILIATED WITH THE SHOW IN ANY WAY. (NOT THAT I'M AGAINST THAT HAPPENING - JUST SAYING)"})}),this.staticPool.addItems("main",{name:"about2",sprite:L({color:"#eee",options:H,maxWidth:this.canvas.config.width-2*this.config.titleSafe,value:"I TAKE NO CREDIT FOR WHAT THE BRILLIANT, TWISTED MINDS OF THE ARTISTS HAVE CREATED; I AM MERELY EXPRESSING MY AFFECTION FOR SAID CREATION WITH A BIT OF 8BIT, JRPG-ESQUE FAN FIC."})}),this.staticPool.addItems("selection",{name:"link",sprite:L({color:"#eee",options:H,value:"SEE MORE..."})}),this.staticPool.addItems("selection",{name:"back",sprite:L({color:"#eee",options:H,value:"BACK TO TITLE SCREEN"})}),z(this),this.dynamicPool.addItems("main",{name:"cursor",sprite:F({metaTile:this.data.cursor})});var e=function(){switch(K.index){case 0:window.open("https://github.com/adventuresinfoon/adventuresinfoon.github.io/blob/main/README.md");break;case 1:t.changeScene("title")}},i=this.staticPool.getGroup("selection");this.controls.upPress=function(){K.index>0&&K.index--},this.controls.downPress=function(){K.index<i.items.length-1&&K.index++},this.controls.aPress=function(){e()},this.controls.startPress=function(){e()}},update:function(){var t=this.staticPool.getGroup("selection");U.update(this,t.items[K.index].sprite.rectangle)},onResize:function(){z(this)}},V=0;function _(t,e,i){var n=!1;V=0,function(t){var e=B({fill:"#000",rectangle:E({x:26,y:26,width:266,height:60})}),i=B({fill:"#eee",rectangle:E({x:26,y:24,width:266,height:2})}),n=B({fill:"#eee",rectangle:E({x:292,y:26,width:2,height:60})}),o=B({fill:"#eee",rectangle:E({x:26,y:86,width:266,height:2})}),a=B({fill:"#eee",rectangle:E({x:24,y:26,width:2,height:60})}),s=B({fill:"#eee",rectangle:E({x:25,y:25,width:2,height:2})}),r=B({fill:"#eee",rectangle:E({x:291,y:25,width:2,height:2})}),l=B({fill:"#eee",rectangle:E({x:291,y:85,width:2,height:2})}),c=B({fill:"#eee",rectangle:E({x:25,y:85,width:2,height:2})});t.dynamicPool.addItems("dialogue",{name:"bg",sprite:e},{name:"borderTop",sprite:i},{name:"borderRight",sprite:n},{name:"borderBottom",sprite:o},{name:"borderLeft",sprite:a},{name:"borderTopLeft",sprite:s},{name:"borderTopRight",sprite:r},{name:"borderBottomRight",sprite:l},{name:"borderBottomLeft",sprite:c})}(t);var o=L({color:"#eee",options:H,value:e[V].name+":"}),a=L({color:"#eee",maxWidth:254,options:H,value:e[V].dialogue});return o.rectangle.x=32,o.rectangle.y=32,a.rectangle.x=32,a.rectangle.y=32+H.lineHeight,a.addAnimation("advance",0,-1,t.config.textAdvanceSpeed,(function(){n=!0})),a.startAnimation("advance"),t.dynamicPool.addItems("dialogue",{name:"nameText",sprite:o},{name:"dialogueText",sprite:a}),{advance:function(){if(n){if(V===e.length-1)return t.dynamicPool.removeGroup("dialogue"),void("function"==typeof i&&i());V++,n=!1,o.value=e[V].name+":",a.value=e[V].dialogue,a.addAnimation("advance",0,-1,t.config.textAdvanceSpeed,(function(){n=!0})),a.startAnimation("advance")}else n=!0,a.stopAnimation()}}}function q(t,e,i){var n=E({width:e.canvas.config.width,height:e.canvas.config.height}),o="in"===t?1:0,a=B({fill:"#000",rectangle:n});e.dynamicPool.addItems("transitions",{name:"rect",sprite:a});var s=function(){o-="in"===t?.26:-.26,a.opacity=o,"in"===t&&o<.1||"out"===t&&o>1?(e.dynamicPool.removeGroup("transitions"),i()):e.delay(8,s)};e.delay(8,s)}var Z={name:"intro",bgColor:"#000",preload:{bg:"src/scenes/assets/intro/viscous-space.json",dialogue:"src/scenes/assets/intro/dialogue.json",static:"src/scenes/assets/intro/static.mp3",viscousSpace:"src/scenes/assets/intro/viscous-space.mp3"},init:function(){var t=this;this.mediaPlayer.play("static",!1,(function(){t.mediaPlayer.play("viscousSpace",!0),t.staticPool.addItems("bg",{name:"bg",sprite:F({metaTile:t.data.bg})}),t.redrawStaticItems(),q("in",t,(function(){var e=_(t,t.data.dialogue,(function(){t.mediaPlayer.pauseAll(),t.changeScene("prologueIntro")}));t.controls.aPress=function(){e.advance()}}))})),this.onResize=function(){return(e=t.staticPool.getItem("bg")).rectangle.x=0,void(e.rectangle.y=0);var e}}},Q={name:"loading",bgColor:"#000",init:function(){var t=L({color:"#eee",options:H,value:"LOADING"});this.staticPool.addItems("main",{name:"main",sprite:t});var e=L({color:"#eee",options:H,value:"..."});e.addAnimation("cycle",0,null,16,"loop"),e.startAnimation("cycle"),this.dynamicPool.addItems("main",{name:"ellipsis",sprite:e});var i=this.canvas.config.height-(t.rectangle.height+16);t.rectangle.x=this.canvas.config.width-(t.rectangle.width+e.rectangle.width+8),t.rectangle.y=i,e.rectangle.x=t.rectangle.x+t.rectangle.width,e.rectangle.y=i}};var $,tt,et={portalShown:!1,portalSpedUp:!1,portalSuckingInCar:!1,portalConsumedCar:!1},it={name:"prologueIntro",bgColor:"#444",preload:{camry:"src/scenes/assets/prologue/camry.json",dialogue:"src/scenes/assets/prologue/dialogue.json",portalLarge:"src/scenes/assets/prologue/portal-large.json",portalSmall:"src/scenes/assets/prologue/portal-small.json",parkingLot:"src/scenes/assets/prologue/parking-lot.json"},init:function(){var t=this;this.staticPool.addItems("main",{name:"smallPortal",sprite:F({metaTile:this.data.parkingLot})});var e=E({width:this.canvas.config.width,height:this.canvas.config.height}),i=F({metaTile:this.data.camry}),n=F({metaTile:this.data.portalSmall}),o=F({metaTile:this.data.portalLarge});tt=[this.data.dialogue.slice(0,3),this.data.dialogue.slice(3,4),this.data.dialogue.slice(4,5)],i.rectangle.centerX(e),i.rectangle.x-=40,i.rectangle.y=e.height/2-4,o.visible=!1,n.visible=!1,this.dynamicPool.addItems("main",{name:"smallPortal",sprite:n},{name:"largePortal",sprite:o},{name:"camry",sprite:i}),q("in",this,(function(){$=_(t,tt[0],(function(){et.portalShown||(et.portalShown=!0,function(t,e,i,n){t.visible=!0,t.rectangle.x=i.canvas.config.width/2+32,t.rectangle.y=i.canvas.config.height/2+8,t.addAnimation("pulse",0,3,4,(function(){e.visible=!0,t.visible=!1,e.rectangle.x=i.canvas.config.width/2+24,e.rectangle.y=i.canvas.config.height/2,e.addAnimation("pulse",0,3,4,"loop"),e.startAnimation("pulse"),i.delay(24,n)})),t.startAnimation("pulse")}(n,o,t,(function(){$=_(t,tt[1],(function(){et.portalSpedUp||(et.portalSpedUp=!0,function(t){t.stopAnimation(),t.addAnimation("pulse",0,3,2,"loop"),t.startAnimation("pulse")}(o),t.delay(24,(function(){et.portalSuckingInCar=!0})))}))})))})),t.controls.aPress=function(){$.advance()}}))},update:function(){var t=this;if(et.portalSuckingInCar){var e=this.dynamicPool.getItem("camry");if(e.rectangle.x+=1,e.rectangle.x>156){et.portalSuckingInCar=!1,et.portalConsumedCar=!0;var i=B({fill:"#eee"});i.rectangle.width=this.canvas.config.width,i.rectangle.height=this.canvas.config.height,this.dynamicPool.addItems("main",{name:"flash",sprite:i}),$=_(this,tt[2],(function(){t.changeScene("prologuePlay")}))}}}};function nt(t){var e=E({width:t.canvas.config.width,height:t.canvas.config.height}),i=t.staticPool.getItem("controls"),n=t.dynamicPool.getItem("anyKey");i.rectangle.centerX(e),i.rectangle.y=18,n.rectangle.centerX(e),n.rectangle.y=e.height-2*H.lineHeight-t.config.titleSafe}var ot={ticksPerBlink:16,tickCount:0,update:function(t){var e=t.dynamicPool.getItem("anyKey");this.tickCount<this.ticksPerBlink?this.tickCount++:(e.visible=!e.visible,this.tickCount=0)}},at={name:"splash",bgColor:"#000",preload:{controls:"src/scenes/assets/splash/controls.json"},init:function(){var t=this;ot.tickCount=0,this.controls.keyDown=function(){t.changeScene("title")},this.staticPool.addItems("main",{name:"controls",sprite:F({metaTile:this.data.controls})}),this.dynamicPool.addItems("main",{name:"anyKey",sprite:L({color:"#eee",options:H,value:"PRESS ANY BUTTON TO CONTINUE"})}),nt(this)},update:function(){ot.update(this)},onResize:function(){nt(this)}};function st(t){var e=E({width:t.canvas.config.width,height:t.canvas.config.height}),i=t.staticPool.getItem("titleText"),n=t.staticPool.getItem("startGame"),o=t.staticPool.getItem("about"),a=t.staticPool.getItem("copyright");i.rectangle.centerX(e),n.rectangle.centerX(e),o.rectangle.centerX(e),a.rectangle.centerX(e),i.rectangle.y=18,n.rectangle.y=154,o.rectangle.y=n.rectangle.y+2*H.lineHeight,a.rectangle.y=e.height-H.lineHeight-t.config.titleSafe}var rt={index:0},lt={name:"title",bgColor:"#000",preload:{theme:"src/scenes/assets/title/theme.mp3",select:"src/scenes/assets/title/select.mp3",titleText:"src/scenes/assets/title/title-text.json",cursor:"src/scenes/assets/title/cursor.json"},init:function(){var t=this;rt.index=0,U.tickCount=0,this.staticPool.addItems("main",{name:"titleText",sprite:F({metaTile:this.data.titleText})}),this.staticPool.addItems("main",{name:"copyright",sprite:L({color:"#eee",options:H,value:"2021 COSMIC POLYGON"})}),this.staticPool.addItems("selection",{name:"startGame",sprite:L({color:"#eee",options:H,value:"START GAME"})}),this.staticPool.addItems("selection",{name:"about",sprite:L({color:"#eee",options:H,value:"ABOUT"})}),st(this),this.dynamicPool.addItems("main",{name:"cursor",sprite:F({metaTile:this.data.cursor})});var e=function(){switch(P.pauseAll(),P.play("select"),rt.index){case 0:t.changeScene("intro");break;case 1:t.changeScene("about")}},i=this.staticPool.getGroup("selection");this.controls.upPress=function(){rt.index>0&&rt.index--},this.controls.downPress=function(){rt.index<i.items.length-1&&rt.index++},this.controls.aPress=function(){e()},this.controls.startPress=function(){e()},P.play("theme",!0)},update:function(){var t=this.staticPool.getGroup("selection");U.update(this,t.items[rt.index].sprite.rectangle)},onResize:function(){st(this)}},ct={debug:{browser:!0,onTick:!1,hitBox:!1},textAdvanceSpeed:2,titleSafe:12},ht=function(t){void 0===t&&(t={});var e=n({ppp:1,width:320,height:240},t);function i(t){var i=document.createElement("canvas");i.id=t,i.width=e.width,i.height=e.height,i.style.position="absolute";var n=i.getContext("2d");return n.imageSmoothingEnabled=!1,{element:i,context:n}}var o=i("static"),a=i("dynamic");return document.body.style.margin="0",document.body.style.backgroundColor="#000",document.body.appendChild(o.element),document.body.appendChild(a.element),{element:{static:o.element,dynamic:a.element},context:{static:o.context,dynamic:a.context},config:e,onResize:null,clear:function(t,e){var i=this.config.width,n=this.config.height,o=this.config.ppp;e?(this.context[t].fillStyle=e,this.context[t].fillRect(0,0,i*o,n*o)):this.context[t].clearRect(0,0,i*o,n*o)},getScaleFactor:function(t,e){var i,n=t>e,o=this.config.width>this.config.height;return(i=n?o&&this.config.height*(t/this.config.width)<=e?t/this.config.width:e/this.config.height:!o&&this.config.width*(e/this.config.height)<=t?e/this.config.height:t/this.config.width)<2?i:Math.floor(i)},fitToViewport:function(){var t=window.innerWidth,e=window.innerHeight,i=this.getScaleFactor(t,e);for(var n in this.config.ppp=i,this.element){var o=this.element[n];o.width=this.config.width*i,o.height=this.config.height*i,o.style.top=e/2-o.height/2+"px",o.style.left=t/2-o.width/2+"px"}"function"==typeof this.onResize&&this.onResize()},requestFullscreen:function(){document.documentElement.requestFullscreen()}}}();ht.fitToViewport(),window.onresize=function(){return ht.fitToViewport()},window.ondeviceorientation=function(){return ht.fitToViewport()},ct.debug.browser||(window.onbeforeunload=function(){return!0}),c={config:ct}.config,function(t,e,i,n){for(var o,a=[],s=4;s<arguments.length;s++)a[s-4]=arguments[s];for(var r in t){var l=t[r];l=x(x({},l),{canvas:i,config:n,controls:w,delay:I.init.bind(I),dynamicPool:d(),data:{},mediaPlayer:P,staticPool:d()}),A[r]=l}A.loading&&(o=A.loading).init.apply(o,a),Y.apply(void 0,k([e],a))}({about:J,intro:Z,loading:Q,prologueIntro:it,splash:at,title:lt},"intro",ht,ct),function(t){l=t.config,r=t.cb,o=Date.now(),h=!0,g()}({cb:function(){var t;t=ht,T?(S(A.loading),X(A.loading)):("function"==typeof b.update&&b.update(t),I.update(),b.controls.update(),X(b))},config:ct})}]);